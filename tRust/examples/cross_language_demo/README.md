# Cross-Language Contract Verification Example

This example demonstrates tRust's cross-language contract verification between a Rust backend and TypeScript frontend.

## Files

- `backend.rs` - Rust API with `#[trust::requires]` and `#[trust::ensures]` contracts
- `contracts.json` - Exported contracts in JSON format (generated by `rustc_vc::contract_export`)
- `frontend.ts` - TypeScript frontend code with intentional violations

## Intentional Violations

The `frontend.ts` file contains several contract violations for testing:

1. **Missing age validation** (`createUser`): The backend requires `age >= 18`, but the frontend doesn't validate this before calling.

2. **Missing email validation** (`createUser`): The backend requires `email.len() > 0`, but the frontend doesn't validate this.

3. **Wrong HTTP method** (`deleteUser`): The backend expects DELETE, but the frontend uses POST.

4. **No precondition checks** (`handleRegistration`, `batchCreateUsers`): These functions pass through to the API without validating preconditions.

## Running the Checker

```bash
# From the tRust root directory
cd tools/ts-contract-checker
npm install
npm run build
npm run check -- ../../examples/cross_language_test/contracts.json ../../examples/cross_language_test/frontend.ts
```

## Expected Output

The checker should report the following violations:

```
Violations found:
1. createUser: Missing precondition check for 'age >= 18'
2. createUser: Missing precondition check for 'email.len() > 0'
3. deleteUser: Wrong HTTP method - expected DELETE, got POST
4. handleRegistration: Calls createUser without validating age >= 18
5. batchCreateUsers: Calls createUser without validating preconditions
```

## Correct Implementations

The file also includes correct implementations for comparison:

- `getUser`: Correctly validates `id > 0` before calling
- `safeCreateUser`: Correctly validates all preconditions

## Contract Export

The `contracts.json` file was generated using `rustc_vc::contract_export`. In a full integration:

```rust
use rustc_vc::contract_export::ContractExport;

let mut export = ContractExport::new("backend");
export.add_function(&create_user_mir, &create_user_specs, "api::users");
// ... add more functions ...

std::fs::write("contracts.json", export.to_json()?)?;
```

Or with the compiler flag:
```bash
trustc --export-contracts=contracts.json backend.rs
```
