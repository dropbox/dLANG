// SIL test file: SwiftUI List onDelete with bounds validation
// Pattern: .onDelete { indexSet in items.remove(atOffsets: indexSet) }
// Auto-VC for bounds check should PASS when indices are validated.

sil_stage canonical

import Builtin
import Swift

// Safe list deletion with validated index
// @_requires("index >= 0 && index < count")
@_requires("index >= 0 && index < count")
func swiftui_list_delete_at_index(_ items: inout Array, _ index: Int, _ count: Int) -> Void

sil hidden @swiftui_list_delete_at_index : $@convention(thin) (Builtin.RawPointer, Int, Int) -> () {
bb0(%0 : $Builtin.RawPointer, %1 : $Int, %2 : $Int):
  debug_value %0, var, name "items", argno 1
  debug_value %1, let, name "index", argno 2
  debug_value %2, let, name "count", argno 3
  // With precondition 0 <= index < count, removal is safe
  %6 = struct_extract %1, #Int._value
  %7 = struct_extract %2, #Int._value
  %8 = integer_literal $Builtin.Int64, 0
  %true = integer_literal $Builtin.Int1, -1
  // Check negative: fail if index < 0
  %neg = builtin "cmp_slt_Int64"(%6, %8) : $Builtin.Int1
  cond_fail %neg, "Index out of range"
  // Check upper bound: fail if index >= count (i.e., NOT(index < count))
  %in = builtin "cmp_slt_Int64"(%6, %7) : $Builtin.Int1
  %oob = builtin "xor_Int1"(%in, %true) : $Builtin.Int1
  cond_fail %oob, "Index out of range"
  // Perform removal (simplified)
  %13 = tuple ()
  return %13 : $()
}

// Unsafe deletion without bounds check - should FAIL
sil hidden @swiftui_list_delete_unsafe : $@convention(thin) (Builtin.RawPointer, Int, Int) -> () {
bb0(%0 : $Builtin.RawPointer, %1 : $Int, %2 : $Int):
  debug_value %0, var, name "items", argno 1
  debug_value %1, let, name "index", argno 2
  debug_value %2, let, name "count", argno 3
  // No precondition - index could be out of bounds
  %6 = struct_extract %1, #Int._value
  %7 = struct_extract %2, #Int._value
  %8 = integer_literal $Builtin.Int64, 0
  %true = integer_literal $Builtin.Int1, -1
  // Check negative: fail if index < 0
  %neg = builtin "cmp_slt_Int64"(%6, %8) : $Builtin.Int1
  cond_fail %neg, "Index out of range"
  // Check upper bound: fail if index >= count (i.e., NOT(index < count))
  %in = builtin "cmp_slt_Int64"(%6, %7) : $Builtin.Int1
  %oob = builtin "xor_Int1"(%in, %true) : $Builtin.Int1
  cond_fail %oob, "Index out of range"
  %13 = tuple ()
  return %13 : $()
}
