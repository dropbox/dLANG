sil_stage canonical

import Builtin
import Swift
import SwiftShims

// makeSome: constructs Optional<Int>.some(value) in-place using enum addr instructions
// This tests init_enum_data_addr and inject_enum_addr for in-place enum construction
// The postcondition is tautology since the function always succeeds (returns unit)
@_ensures("true")
func makeSome(_ value: Int) -> Optional<Int>

sil hidden @$s22enum_addr_construction8makeSomeyS2iSgF : $@convention(thin) (Int) -> @out Optional<Int> {
bb0(%0 : $*Optional<Int>, %1 : $Int):
  debug_value %1, let, name "value", argno 1
  // Get address for the payload data slot in the Optional
  %2 = init_enum_data_addr %0 : $*Optional<Int>, #Optional.some!enumelt
  // Store the Int value to the payload slot
  store %1 to %2 : $*Int
  // Set the discriminator to .some
  inject_enum_addr %0 : $*Optional<Int>, #Optional.some!enumelt
  %5 = tuple ()
  return %5 : $()
} // end sil function '$s22enum_addr_construction8makeSomeyS2iSgF'
