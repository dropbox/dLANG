sil_stage canonical

import Builtin
import Swift
import SwiftShims

@_requires("x > 0")
@_ensures("result > 0")
func keepPositive(_ x: Int) -> Int

@_requires("a >= 0")
@_requires("b >= 0")
@_ensures("result >= 0")
func safeAdd(_ a: Int, _ b: Int) -> Int

@_trusted func unsafeOperation() -> Int

// main
// Isolation: unspecified
sil @main : $@convention(c) (Int32, UnsafeMutablePointer<Optional<UnsafeMutablePointer<Int8>>>) -> Int32 {
bb0(%0 : $Int32, %1 : $UnsafeMutablePointer<Optional<UnsafeMutablePointer<Int8>>>):
  %2 = integer_literal $Builtin.Int32, 0          // user: %3
  %3 = struct $Int32 (%2)                         // user: %4
  return %3                                       // id: %4
} // end sil function 'main'

// keepPositive(_:)
// Isolation: unspecified
sil hidden @$s17verified_positive12keepPositiveyS2iF : $@convention(thin) (Int) -> Int {
// %0 "x"                                         // users: %2, %1
bb0(%0 : $Int):
  debug_value %0, let, name "x", argno 1          // id: %1
  return %0                                       // id: %2
} // end sil function '$s17verified_positive12keepPositiveyS2iF'

// safeAdd(_:_:)
// Isolation: unspecified
sil hidden @$s17verified_positive7safeAddyS2i_SitF : $@convention(thin) (Int, Int) -> Int {
// %0 "a"                                         // users: %4, %2
// %1 "b"                                         // users: %5, %3
bb0(%0 : $Int, %1 : $Int):
  debug_value %0, let, name "a", argno 1          // id: %2
  debug_value %1, let, name "b", argno 2          // id: %3
  %4 = struct_extract %0, #Int._value             // user: %7
  %5 = struct_extract %1, #Int._value             // user: %7
  %6 = integer_literal $Builtin.Int1, -1          // user: %7
  %7 = builtin "sadd_with_overflow_Int64"(%4, %5, %6) : $(Builtin.Int64, Builtin.Int1) // users: %9, %8
  %8 = tuple_extract %7, 0                        // user: %11
  %9 = tuple_extract %7, 1                        // user: %10
  cond_fail %9, "arithmetic overflow"             // id: %10
  %11 = struct $Int (%8)                          // user: %12
  return %11                                      // id: %12
} // end sil function '$s17verified_positive7safeAddyS2i_SitF'

// static Int.+ infix(_:_:)
// Isolation: unspecified
sil public_external [transparent] @$sSi1poiyS2i_SitFZ : $@convention(method) (Int, Int, @thin Int.Type) -> Int {
// %0                                             // user: %3
// %1                                             // user: %4
bb0(%0 : $Int, %1 : $Int, %2 : $@thin Int.Type):
  %3 = struct_extract %0, #Int._value             // user: %6
  %4 = struct_extract %1, #Int._value             // user: %6
  %5 = integer_literal $Builtin.Int1, -1          // user: %6
  %6 = builtin "sadd_with_overflow_Int64"(%3, %4, %5) : $(Builtin.Int64, Builtin.Int1) // users: %8, %7
  %7 = tuple_extract %6, 0                        // user: %10
  %8 = tuple_extract %6, 1                        // user: %9
  cond_fail %8, "arithmetic overflow"             // id: %9
  %10 = struct $Int (%7)                          // user: %11
  return %10                                      // id: %11
} // end sil function '$sSi1poiyS2i_SitFZ'

// unsafeOperation()
// Isolation: unspecified
sil hidden @$s17verified_positive15unsafeOperationSiyF : $@convention(thin) () -> Int {
bb0:
  %0 = integer_literal $Builtin.Int64, 42         // user: %1
  %1 = struct $Int (%0)                           // user: %2
  return %1                                       // id: %2
} // end sil function '$s17verified_positive15unsafeOperationSiyF'

// Int.init(_builtinIntegerLiteral:)
// Isolation: unspecified
sil public_external [transparent] @$sSi22_builtinIntegerLiteralSiBI_tcfC : $@convention(method) (Builtin.IntLiteral, @thin Int.Type) -> Int {
// %0                                             // user: %2
bb0(%0 : $Builtin.IntLiteral, %1 : $@thin Int.Type):
  %2 = builtin "s_to_s_checked_trunc_IntLiteral_Int64"(%0) : $(Builtin.Int64, Builtin.Int1) // user: %3
  %3 = tuple_extract %2, 0                        // user: %4
  %4 = struct $Int (%3)                           // user: %5
  return %4                                       // id: %5
} // end sil function '$sSi22_builtinIntegerLiteralSiBI_tcfC'



// Mappings from '#fileID' to '#filePath':
//   'verified_positive/verified_positive.swift' => '/Users/ayates/tSwift/vc-ir-swift/tests/sil_examples/verified_positive.swift'


