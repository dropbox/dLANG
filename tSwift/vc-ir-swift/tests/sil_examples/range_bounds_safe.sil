// Test range bounds checking with explicit preconditions.
// Swift: start..<end requires start <= end

sil_stage canonical

import Builtin
import Swift

@_requires("end >= start")
func makeRangeSafe(start: Int, end: Int) -> ()

// makeRangeSafe: Create a half-open range from start to end
// This checks that start <= end, but the precondition makes it unreachable.
sil @makeRangeSafe : $@convention(thin) (Int, Int) -> () {
bb0(%0 : $Int, %1 : $Int):
  debug_value %0, let, name "start", argno 1
  debug_value %1, let, name "end", argno 2
  %4 = struct_extract %0, #Int._value
  %5 = struct_extract %1, #Int._value
  // Check: start <= end (i.e., !(end < start))
  %6 = builtin "cmp_slt_Int64"(%5, %4) : $Builtin.Int1
  cond_fail %6, "Range requires lowerBound <= upperBound"
  %8 = tuple ()
  return %8
}

@_requires("end >= start")
func makeClosedRangeSafe(start: Int, end: Int) -> ()

// makeClosedRangeSafe: Create a closed range from start to end
// This also checks that start <= end, but the precondition makes it unreachable.
sil @makeClosedRangeSafe : $@convention(thin) (Int, Int) -> () {
bb0(%0 : $Int, %1 : $Int):
  debug_value %0, let, name "start", argno 1
  debug_value %1, let, name "end", argno 2
  %4 = struct_extract %0, #Int._value
  %5 = struct_extract %1, #Int._value
  // Check: start <= end (i.e., !(end < start))
  %6 = builtin "cmp_slt_Int64"(%5, %4) : $Builtin.Int1
  cond_fail %6, "Range requires lowerBound <= upperBound"
  %8 = tuple ()
  return %8
}

